---
import fs from 'fs';
import path from 'path';
import { fetchExhibitionSheet } from '../../utils/fetchSheet';

interface Params {
    id: string;
}

const { id } = Astro.params as unknown as Params; // Dynamic exhibition ID from URL

// Path to the exhibition folder (current exhibitions)
const exhibitionDir = path.resolve(`./src/data/exhibitions/current/${id}`);

// Read JSON files
const metadata = JSON.parse(fs.readFileSync(path.join(exhibitionDir, 'metadata.json'), 'utf-8'));
const floors = JSON.parse(fs.readFileSync(path.join(exhibitionDir, 'floors.json'), 'utf-8'));
const artworks = JSON.parse(fs.readFileSync(path.join(exhibitionDir, 'artworks.json'), 'utf-8'));

// Fetch dynamic price/sold from Google Sheets
const sheetData = await fetchExhibitionSheet('SPREADSHEET_ID', id);

// Merge JSON artworks with sheet data
const mergedArtworks = artworks.map((a: any) => {
    const sheet = sheetData.find(s => s.id === a.id);
    return { ...a, ...sheet }; // Merges price/sold into the artwork object
});
---
