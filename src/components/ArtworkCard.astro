---
import type { Artist } from '../types/gallery';
import { withBase } from '../utils/withBase';

interface Props {
  id: string;
  title: string;
  artist: Artist;
  imageUrl: string;
  year?: string;
  description?: string;
  price?: number;
  sold?: boolean;
  forSale?: boolean;
}

const { id, title, artist, imageUrl, year, description, price, sold, forSale } = Astro.props;
const resolvedImage = withBase(imageUrl);

const formattedPrice =
  typeof price === 'number'
    ? new Intl.NumberFormat('ro-RO', {
        style: 'currency',
        currency: 'EUR',
        maximumFractionDigits: 0,
      }).format(price)
    : null;

const statusText = sold
  ? 'VANDUT'
  : forSale
    ? formattedPrice || 'Pret la cerere'
    : 'Nu este de vanzare';
---

<article
  class="artwork-card"
  data-artwork-id={id}
  data-for-sale={forSale ? 'true' : 'false'}
  data-sold={sold ? 'true' : 'false'}
  data-price={typeof price === 'number' ? String(price) : ''}
>
  <div class="artwork-image">
    <img src={resolvedImage} alt={title} loading="lazy" />
    <span class="sold-badge" data-role="sold-badge" aria-hidden={!sold} hidden={!sold}>
      VANDUT
    </span>
  </div>
  <div class="artwork-meta">
    <h3 class="artwork-title">{title}</h3>
    <p class="artwork-author">
      <a class="artist-link" href={`artist/${artist.id}/`}>{artist.name}</a>
    </p>
    {year ? <p class="artwork-year">{year}</p> : null}
    {description ? <p class="artwork-description">{description}</p> : null}
    <p class="artwork-status" data-role="artwork-status">{statusText}</p>
  </div>
</article>
